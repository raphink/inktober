<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isaiah 49:1-6</title>
    <!-- Import Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Merriweather', serif;
        }
        .background {
            background-image: url('islands.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            filter: brightness(20%); /* Dim the background to 20% brightness */
            z-index: 1;
        }
        .foreground-background {
            background-image: url('islands.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            clip-path: polygon(50% 50%, 0% 100%, 100% 100%); /* Initially cover the foreground with a placeholder clip path */
            z-index: 3;
        }
        .lighthouse {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 4; /* Ensure the lighthouse is always visible */
            /* Placeholder for lighthouse image */
            width: 40px;
            height: 80px;
            background: url('lighthouse.png') no-repeat center center;
            background-size: contain;
        }
        .verse {
            position: absolute;
            color: #fff;
            font-size: 2em;
            text-shadow: 2px 2px 4px #000;
            transition: opacity 1s;
            opacity: 0;
            z-index: 6;
            pointer-events: auto; /* Allow mouse events */
            cursor: pointer;
            max-width: 80%;
            word-wrap: break-word;
            box-sizing: border-box;
        }
        /* Classes to control opacity */
        .verse.hovered,
        .verse.lit {
            opacity: 1;
        }
        .reveal-cone {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            background: radial-gradient(circle at center, rgba(255, 255, 200, 0.6) 0%, rgba(255, 255, 200, 0.1) 30%, rgba(255, 255, 200, 0) 100%);
            clip-path: polygon(50% 50%, 0% 100%, 100% 100%); /* Placeholder clip path */
            z-index: 2;
        }
        .flickering-circle {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 200, 0.8), rgba(255, 255, 200, 0) 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            animation: flicker 1.5s infinite alternate;
            pointer-events: none;
        }
        @keyframes flicker {
            0% { opacity: 0.8; }
            50% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }
        .intermediate-background {
            background-image: url('islands.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            clip-path: circle(120px at 50% 50%);
            mask-image: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%); /* Gradient mask for smooth blending */
            z-index: 2;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .verse {
                font-size: 1.5em;
                max-width: 90%;
            }

            #verse1 {
                top: 20%;
                left: 10%;
                transform: none;
            }

            #verse2 {
                top: 40%;
                left: 60%;
                transform: none;
            }
        }

        @media (max-width: 480px) {
            .verse {
                font-size: 1.2em;
                max-width: 95%;
                left: 50%;
                transform: translateX(-50%);
            }

            #verse1 {
                top: 10%;
            }

            #verse2 {
                top: 50%;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="foreground-background"></div>
    <div class="intermediate-background"></div>
    <div class="lighthouse"></div>
    
    <!-- Verses -->
    <div class="verse" style="top: 20%; left: 20%;" id="verse1" tabindex="0" role="button" aria-label="Verse 1">
        "Listen to me, you islands;<br /> hear this, you distant nations..."
    </div>
    <div class="verse" style="top: 70%; left: 50%;" id="verse2" tabindex="0" role="button" aria-label="Verse 2">
        "I will also make you a light for the Gentiles,<br /> that my salvation may reach to the ends of the earth."
    </div>
    
    <div class="reveal-cone"></div>
    <div class="flickering-circle"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Helper function to add or remove classes
            function toggleClass(element, className, condition) {
                if (condition) {
                    element.classList.add(className);
                } else {
                    element.classList.remove(className);
                }
            }

            // Initialize verses
            const verses = [
                {
                    element: document.getElementById('verse1'),
                    isHovered: false,
                    isLit: false
                },
                {
                    element: document.getElementById('verse2'),
                    isHovered: false,
                    isLit: false
                }
            ];

            // Add hover event listeners to verses
            verses.forEach(verse => {
                verse.element.addEventListener('mouseenter', function() {
                    verse.isHovered = true;
                    toggleClass(verse.element, 'hovered', true);
                });
                verse.element.addEventListener('mouseleave', function() {
                    verse.isHovered = false;
                    toggleClass(verse.element, 'hovered', false);
                });
            });

            let autoRotate = true;
            let currentAngle = 0;

            // Helper function to normalize angles between 0-360 degrees
            function normalizeAngle(angle) {
                return (angle % 360 + 360) % 360;
            }

            // Helper function to calculate the smallest difference between two angles
            function angleDifference(angle1, angle2) {
                let diff = Math.abs(angle1 - angle2) % 360;
                return diff > 180 ? 360 - diff : diff;
            }

            // Function to calculate angle from lighthouse to a point
            function calculateAngle(lighthouseX, lighthouseY, pointX, pointY) {
                let angleRad = Math.atan2(pointY - lighthouseY, pointX - lighthouseX);
                let angleDeg = angleRad * (180 / Math.PI);
                return normalizeAngle(angleDeg);
            }

            function rotateLight() {
                if (!autoRotate) return;
                currentAngle += 0.2; // Slower rotation
                if (currentAngle >= 360) currentAngle = 0;
                updateLightPosition(currentAngle);
                requestAnimationFrame(rotateLight);
            }

            function updateLightPosition(angle) {
                const lighthouse = document.querySelector('.lighthouse');
                const foregroundBackground = document.querySelector('.foreground-background');
                const revealCone = document.querySelector('.reveal-cone');
                const intermediateBackground = document.querySelector('.intermediate-background');

                const radians = (angle * Math.PI) / 180;

                // Calculate lighthouse position
                const rect = lighthouse.getBoundingClientRect();
                const lighthouseX = rect.left + rect.width / 2 - 10;
                const lighthouseY = rect.top; // Top center of the lighthouse

                // Beam parameters
                const narrowWidth = 30; // Narrow width at the lighthouse
                const wideWidth = 800; // Wide width at the distant side to ensure it reaches the sides of the screen
                const beamLength = 2000; // Extended length to ensure coverage

                // Calculate clip path points for the beam
                const clipPathX1 = lighthouseX;
                const clipPathY1 = lighthouseY;
                const clipPathX3 = lighthouseX + beamLength * Math.cos(radians) + wideWidth * Math.cos(radians - Math.PI / 2);
                const clipPathY3 = lighthouseY + beamLength * Math.sin(radians) + wideWidth * Math.sin(radians - Math.PI / 2);
                const clipPathX4 = lighthouseX + beamLength * Math.cos(radians) + wideWidth * Math.cos(radians + Math.PI / 2);
                const clipPathY4 = lighthouseY + beamLength * Math.sin(radians) + wideWidth * Math.sin(radians + Math.PI / 2);
                
                // Update clip paths to visualize the beam
                foregroundBackground.style.clipPath = `polygon(${clipPathX1}px ${clipPathY1}px, ${clipPathX3}px ${clipPathY3}px, ${clipPathX4}px ${clipPathY4}px)`;
                revealCone.style.clipPath = `polygon(${clipPathX1}px ${clipPathY1}px, ${clipPathX3}px ${clipPathY3}px, ${clipPathX4}px ${clipPathY4}px)`;

                // Update each verse's lit state based on the beam's angle
                verses.forEach(verse => {
                    const verseRect = verse.element.getBoundingClientRect();
                    const verseX = verseRect.left + verseRect.width / 2;
                    const verseY = verseRect.top + verseRect.height / 2;

                    // Calculate the angle from the lighthouse to the verse
                    const verseAngle = calculateAngle(lighthouseX, lighthouseY, verseX, verseY);

                    // Calculate the difference between the current beam angle and the verse angle
                    const diff = angleDifference(angle, verseAngle);

                    // Define a threshold angle to consider the verse as lit
                    const threshold = 10; // degrees

                    // Update the lit state based on the angle difference
                    verse.isLit = diff <= threshold;
                    toggleClass(verse.element, 'lit', verse.isLit);
                });
            }

            document.addEventListener('mousemove', function (event) {
                autoRotate = false;
                const lighthouse = document.querySelector('.lighthouse');
                const foregroundBackground = document.querySelector('.foreground-background');
                const revealCone = document.querySelector('.reveal-cone');
                const intermediateBackground = document.querySelector('.intermediate-background');

                const rect = lighthouse.getBoundingClientRect();
                const lighthouseX = rect.left + rect.width / 2;
                const lighthouseY = rect.top; // Top center of the lighthouse

                // Calculate the angle from lighthouse to mouse position
                const angleRad = Math.atan2(event.clientY - lighthouseY, event.clientX - lighthouseX);
                let angleDeg = angleRad * (180 / Math.PI);
                angleDeg = normalizeAngle(angleDeg);
                currentAngle = angleDeg;
                updateLightPosition(currentAngle);
            });

            let inactivityTimer;
            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    autoRotate = true;
                    rotateLight();
                }, 3000);
            }
            
            document.addEventListener('mousemove', resetInactivityTimer);
            resetInactivityTimer();

            rotateLight();
        });
    </script>
</body>
</html>
