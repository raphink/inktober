<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isaiah 49:1-6</title>
    <style>
        body, html {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background-color: #000;
        }
        .background {
            background-image: url('islands.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            filter: brightness(20%); /* Dim the background to 20% brightness */
            z-index: 1;
        }
        .foreground-background {
            background-image: url('islands.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            clip-path: polygon(50% 50%, 0% 100%, 100% 100%); /* Initially cover the foreground with a placeholder clip path */
            z-index: 3;
        }
        .lighthouse {
            position: absolute;
            left: calc(50% - 10px); /* Adjusted offset from the middle */
            top: calc(50% - 40px); /* Adjusted offset from the middle */
            transform: translate(-50%, -50%);
            z-index: 4; /* Ensure the lighthouse is always visible */
        }
        .verse {
            position: absolute;
            color: #fff;
            font-size: 2em;
            text-shadow: 2px 2px 4px #000;
            transition: opacity 1s;
            opacity: 0;
        }
        .reveal-cone {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            background: radial-gradient(circle at center, rgba(255, 255, 200, 0.6) 0%, rgba(255, 255, 200, 0.1) 30%, rgba(255, 255, 200, 0) 100%);
            clip-path: polygon(50% 50%, 0% 100%, 100% 100%); /* Placeholder clip path */
            z-index: 2;
        }
        .flickering-circle {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 200, 0.8), rgba(255, 255, 200, 0) 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            animation: flicker 1.5s infinite alternate;
            pointer-events: none;
        }
        @keyframes flicker {
            0% { opacity: 0.8; }
            50% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }
        .intermediate-background {
            background-image: url('islands.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            clip-path: circle(150px at 50% 50%);
            mask-image: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%); /* Gradient mask for smooth blending */
            z-index: 2;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="foreground-background"></div>
    <div class="intermediate-background"></div>
    <div class="lighthouse"></div>
    <div class="verse" style="top: 20%; left: 20%; z-index: 6;" id="verse1">"Listen to me, you islands;<br /> hear this, you distant nations..."</div>
    <script>
        document.getElementById('verse1').addEventListener('mouseenter', function() {
            document.getElementById('verse1').style.opacity = 1;
        });
        document.getElementById('verse1').addEventListener('mouseleave', function() {
            document.getElementById('verse1').style.opacity = 0;
        });
    </script>
    <div class="verse" style="top: 80%; left: 60%; z-index: 6;" id="verse2">"I will also make you a light for the Gentiles,<br /> that my salvation may reach to the ends of the earth."</div>
    <script>
        document.getElementById('verse2').addEventListener('mouseenter', function() {
            document.getElementById('verse2').style.opacity = 1;
        });
        document.getElementById('verse2').addEventListener('mouseleave', function() {
            document.getElementById('verse2').style.opacity = 0;
        });
    </script>
    <div class="reveal-cone"></div>
    <div class="flickering-circle"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let autoRotate = true;
        let currentAngle = 0;

        function rotateLight() {
            if (!autoRotate) return;
            currentAngle += 0.5;
            if (currentAngle >= 360) currentAngle = 0;
            updateLightPosition(currentAngle);
            requestAnimationFrame(rotateLight);
        }

        function updateLightPosition(angle) {
            const lighthouse = document.querySelector('.lighthouse');
            const foregroundBackground = document.querySelector('.foreground-background');
            const revealCone = document.querySelector('.reveal-cone');
            const intermediateBackground = document.querySelector('.intermediate-background');
            const verse1 = document.getElementById('verse1');
            const verse2 = document.getElementById('verse2');

            const rect = lighthouse.getBoundingClientRect();
            const lighthouseX = rect.left + rect.width / 2;
            const lighthouseY = rect.top + rect.height / 2;

            const radians = (angle * Math.PI) / 180;

            // Reveal parts of the foreground background based on light position with a fixed shape rotating
            const narrowWidth = 30; // Narrow width at the lighthouse
            const wideWidth = 800; // Wide width at the distant side to ensure it reaches the sides of the screen
            const beamLength = 2000; // Extended length to ensure coverage
            const clipPathX1 = lighthouseX;
            const clipPathY1 = lighthouseY;
            const clipPathX2 = lighthouseX + narrowWidth * Math.cos(radians - Math.PI / 2);
            const clipPathY2 = lighthouseY + narrowWidth * Math.sin(radians - Math.PI / 2);
            const clipPathX3 = lighthouseX + beamLength * Math.cos(radians) + wideWidth * Math.cos(radians - Math.PI / 2);
            const clipPathY3 = lighthouseY + beamLength * Math.sin(radians) + wideWidth * Math.sin(radians - Math.PI / 2);
            const clipPathX4 = lighthouseX + beamLength * Math.cos(radians) + wideWidth * Math.cos(radians + Math.PI / 2);
            const clipPathY4 = lighthouseY + beamLength * Math.sin(radians) + wideWidth * Math.sin(radians + Math.PI / 2);
            foregroundBackground.style.clipPath = `polygon(${clipPathX1}px ${clipPathY1}px, ${clipPathX2}px ${clipPathY2}px, ${clipPathX3}px ${clipPathY3}px, ${clipPathX4}px ${clipPathY4}px)`;
            intermediateBackground.style.clipPath = `circle(150px at 50% 50%)`;
            revealCone.style.clipPath = `polygon(${clipPathX1}px ${clipPathY1}px, ${clipPathX2}px ${clipPathY2}px, ${clipPathX3}px ${clipPathY3}px, ${clipPathX4}px ${clipPathY4}px)`;

            // Highlight verses when light passes over them
            const distanceToVerse1 = Math.hypot(lighthouseX + beamLength * Math.cos(radians) - verse1.offsetLeft, lighthouseY + beamLength * Math.sin(radians) - verse1.offsetTop);
            const distanceToVerse2 = Math.hypot(lighthouseX + beamLength * Math.cos(radians) - verse2.offsetLeft, lighthouseY + beamLength * Math.sin(radians) - verse2.offsetTop);

            if (distanceToVerse1 < 200) {
                verse1.style.opacity = 1;
            } else {
                verse1.style.opacity = 0;
            }

            if (distanceToVerse2 < 200) {
                verse2.style.opacity = 1;
            } else {
                verse2.style.opacity = 0;
            }
        }

        document.addEventListener('mousemove', function (event) {
                autoRotate = false;
            const lighthouse = document.querySelector('.lighthouse');
            const foregroundBackground = document.querySelector('.foreground-background');
            const revealCone = document.querySelector('.reveal-cone');
            const intermediateBackground = document.querySelector('.intermediate-background');
            const verse1 = document.getElementById('verse1');
            const verse2 = document.getElementById('verse2');

            const rect = lighthouse.getBoundingClientRect();
            const lighthouseX = rect.left + rect.width / 2;
            const lighthouseY = rect.top + rect.height / 2;

            const angle = Math.atan2(event.clientY - lighthouseY, event.clientX - lighthouseX) * 180 / Math.PI;
            updateLightPosition(angle);
        });

        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                autoRotate = true;
                rotateLight();
            }, 3000);
        }
        
        document.addEventListener('mousemove', resetInactivityTimer);
        resetInactivityTimer();

        rotateLight();
    </script>
</body>
</html>